{"version":3,"sources":["webpack:///./src/utils/resetForm.js","webpack:///./src/components/user/member/homepage.vue","webpack:///./src/components/user/member/homepage.vue?863c"],"names":["resetForm","target","reset","obj","Object","keys","map","key","Array","element","undefined","class","data-space-bottom","_createElementVNode","style","data-space-left","for","data-space-top","_createElementBlock","_hoisted_3","_toDisplayString","$setup","memberForm","account","benefitsList","level","_hoisted_6","_hoisted_9","_createVNode","_component_InputText","type","Name","$event","$error","_hoisted_10","_hoisted_12","Email","_hoisted_13","_hoisted_15","Phone","_hoisted_16","_hoisted_18","Address","_hoisted_19","_hoisted_20","_hoisted_22","_hoisted_24","Password","_hoisted_25","_hoisted_27","pwdConfirm","_hoisted_28","_hoisted_29","_hoisted_31","_component_RadioButton","id","name","value","checked","_hoisted_33","_hoisted_35","_hoisted_36","onClick","data-space-right","setup","inject","toast","useToast","store","useStore","state","reactive","benefits","nextLevel","nextLevelCash","levels","threshold","rules","computed","required","minLength","email","sameAs","v$","useVuelidate","getMemberData","onMounted","async","console","log","data","callApi","memberData","res","Data","Account","handleReset","handleMemberUpdate","$validate","add","severity","summary","group","updateMemberData","memberVerify","memberUpdate","getBenefitsData","levelChange","total","Consumption","userLevel","find","commit","__exports__","render"],"mappings":"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","file":"js/chunk-28de11a3.42345b86.js","sourcesContent":["export const resetForm = (target) => {\n  const reset = (obj) => {\n    Object.keys(obj).map((key) => {\n      if (obj[key] === Object(obj[key])) {\n        reset(obj[key])\n        if (obj[key] instanceof Array) {\n          obj[key] = []\n        }\n        return\n      } else {\n        // 保留型別\n        const element = obj[key]\n        switch (typeof element) {\n          case 'string':\n            obj[key] = ''\n            break\n          case 'number':\n            obj[key] = 0\n            break\n          case 'object':\n            obj[key] = element instanceof Array ? [] : {}\n            break\n          case 'boolean':\n            obj[key] = false\n            break\n          default:\n            obj[key] = undefined\n            break\n        }\n      }\n    })\n  }\n  reset(target)\n}\n","<template>\n  <div class=\"homepage container\">\n    <div class=\"row horizontal v_center\" data-space-bottom=\"2rem\">\n      <i class=\"pi pi-user\" style=\"font-size: 1.5rem\"></i>\n      <p data-space-left=\"1rem\">{{ state.memberForm.account }}</p>\n      <div class=\"member-level\">{{ state.benefitsList.level }}</div>\n    </div>\n    <div class=\"row horizontal v_center\" data-space-bottom=\"1rem\">\n      <i class=\"pi pi-pencil\" style=\"font-size: 1rem\"></i>\n      <p data-space-left=\"1rem\">編輯會員資料</p>\n    </div>\n    <div class=\"member-edit\">\n      <div class=\"member-detail\">\n        <p>姓名*</p>\n        <InputText type=\"text\" v-model=\"state.memberForm.Name\" />\n        <span v-if=\"v$.Name.$error\"> {{ '請輸入兩字以上名字' }} </span>\n      </div>\n      <div class=\"member-detail\">\n        <p>電子郵件*</p>\n        <InputText type=\"text\" v-model=\"state.memberForm.Email\" />\n        <span v-if=\"v$.Email.$error\"> {{ '請輸入電子郵件' }} </span>\n      </div>\n      <div class=\"member-detail\">\n        <p>聯絡電話</p>\n        <InputText type=\"text\" v-model=\"state.memberForm.Phone\" />\n        <span v-if=\"v$.Phone.$error\"> {{ '請輸入正確的聯絡電話' }} </span>\n      </div>\n      <div class=\"member-detail\" data-space-bottom=\"2rem\">\n        <p>寄件地址</p>\n        <InputText type=\"text\" v-model=\"state.memberForm.Address\" />\n      </div>\n      <hr />\n      <p>如若不需更改密碼，請直接留空</p>\n      <div class=\"member-detail\">\n        <p>原始密碼</p>\n        <InputText type=\"password\" />\n      </div>\n      <div class=\"member-detail\">\n        <p>設定新密碼</p>\n        <InputText type=\"password\" v-model=\"state.memberForm.Password\" />\n        <span v-if=\"v$.Password.$error\"> {{ '密碼請輸入最少8位以上' }} </span>\n      </div>\n      <div class=\"member-detail\" data-space-bottom=\"2rem\">\n        <p>確認新密碼</p>\n        <InputText type=\"password\" v-model=\"state.pwdConfirm\" />\n        <span v-if=\"state.pwdConfirm !== state.memberForm.Password\"> {{ '請再次輸入密碼' }} </span>\n      </div>\n      <hr />\n      <div class=\"member-detail_exception\">\n        <p>電子報</p>\n        <div class=\"field-radiobutton\">\n          <RadioButton id=\"news1\" name=\"news\" :value=\"true\" v-model=\"state.checked\" />\n          <label for=\"news1\" data-space-left=\"0.5rem\">訂閱</label>\n        </div>\n        <div data-space-left=\"1rem\">\n          <RadioButton id=\"news2\" name=\"news\" :value=\"false\" v-model=\"state.checked\" />\n          <label for=\"news2\" data-space-left=\"0.5rem\">不訂閱</label>\n        </div>\n      </div>\n      <span>訂閱商品/活動訊息，我們將不定期透過email通知最新商品活動及優惠訊息。</span>\n      <div class=\"row horizontal\" data-space-top=\"3rem\">\n        <button class=\"button_cancel\" @click=\"handleReset\" data-space-right=\"1rem\">重新填寫</button>\n        <button class=\"button_confirm\" @click=\"memberVerify\">儲存變更</button>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nimport { onMounted, reactive, computed, inject } from 'vue'\nimport { memberData, updateMemberData, benefitsList } from '@/service/api'\nimport { callApi } from '@/utils/callApi'\nimport { resetForm } from '@/utils/resetForm'\nimport { useToast } from 'primevue/usetoast'\nimport { email, required, minLength, sameAs } from '@vuelidate/validators'\nimport useVuelidate from '@vuelidate/core'\nimport { useStore } from 'vuex'\n\nexport default {\n  name: 'Homepage',\n  setup() {\n    const reload = inject('reload')\n    const toast = useToast()\n    const store = useStore()\n    const state = reactive({\n      memberForm: {\n        account: '',\n        Name: '',\n        Email: '',\n        Phone: '',\n        Address: '',\n        Password: ''\n      },\n      checked: true,\n      pwdConfirm: '',\n      benefits: {},\n      benefitsList: {\n        level: '',\n        nextLevel: '',\n        nextLevelCash: ''\n      },\n      levels: [\n        {\n          threshold: 0,\n          name: '銅級會員'\n        },\n        {\n          threshold: 5000,\n          name: '銀級會員'\n        },\n        {\n          threshold: 10000,\n          name: '金級會員'\n        },\n        {\n          threshold: 20000,\n          name: '白金會員'\n        }\n      ]\n    })\n    const rules = computed(() => {\n      return {\n        Name: { required, minLength: minLength(2) },\n        Email: { required, email },\n        Password: { minLength: minLength(8) },\n        pwdConfirm: { sameAs: sameAs(state.memberForm.Password) },\n        Phone: { minLength: minLength(10) }\n      }\n    })\n    const v$ = useVuelidate(rules, state.memberForm)\n    //取得該會員資料\n    const getMemberData = onMounted(async () => {\n      console.log(v$)\n      const data = ''\n      await callApi(memberData, data, (res) => {\n        state.memberForm.Name = res.data.Data.Name\n        state.memberForm.Email = res.data.Data.Email\n        state.memberForm.Phone = res.data.Data.Phone\n        state.memberForm.Address = res.data.Data.Address\n        state.memberForm.account = res.data.Data.Account\n      })\n    })\n\n    //重新填寫會員資料\n    const handleReset = () => {\n      resetForm(state.memberForm)\n      getMemberData()\n    }\n\n    //會員資料更新\n    const handleMemberUpdate = async () => {\n      v$.value.$validate()\n      const data = state.memberForm\n      if (!v$.value.$error && state.memberForm.Name !== '' && state.memberForm.Email !== '') {\n        if (state.memberForm.Password !== state.pwdConfirm) {\n          toast.add({ severity: 'error', summary: '輸入錯入，請重新輸入！', group: 'errorBox' })\n        } else {\n          callApi(updateMemberData, data, () => {\n            getMemberData()\n            toast.add({ severity: 'success', summary: '更新成功！', group: 'successBox' })\n          })\n        }\n      } else {\n        toast.add({ severity: 'error', summary: '填寫錯誤，請重新填寫', group: 'errorBox' })\n      }\n    }\n    //會員資料認證\n    const memberVerify = () => {\n      v$.value.$validate()\n      if (state.memberForm.Name && state.memberForm.Email) {\n        if (state.memberForm.Password && state.pwdConfirm && state.memberForm.Password !== state.pwdConfirm) {\n          toast.add({ severity: 'error', summary: '密碼輸入錯誤！', group: 'errorBox' })\n        } else {\n          memberUpdate()\n        }\n      } else {\n        toast.add({ severity: 'error', summary: '必填格式空白或錯誤！', group: 'errorBox' })\n      }\n    }\n    //會員資料更新\n    const memberUpdate = () => {\n      const data = state.memberForm\n      callApi(updateMemberData, data, () => {\n        getMemberData()\n        toast.add({ severity: 'success', summary: '更新成功！', group: 'successBox' })\n      })\n    }\n    //得到優惠券資料\n    const getBenefitsData = onMounted(() => {\n      const data = ''\n      callApi(benefitsList, data, (res) => {\n        state.benefits = { ...res.data.Data }\n        levelChange()\n      })\n    })\n\n    //根據消費金額確認會員等級\n    const levelChange = () => {\n      const total = state.benefits.Consumption\n      const userLevel = state.levels.find((level) => total >= level.threshold)\n      const nextLevel = state.levels.find((level) => total < level.threshold)\n      const nextLevelCash = nextLevel.threshold - total\n\n      state.benefitsList = {\n        level: userLevel.name,\n        nextLevel: nextLevel.name,\n        nextLevelCash: nextLevelCash\n      }\n      store.commit('memberModules/SET_USERBENEFITS', state.benefitsList)\n    }\n    return {\n      state,\n      getMemberData,\n      rules,\n      v$,\n      getBenefitsData,\n      handleReset,\n      handleMemberUpdate,\n      memberVerify\n    }\n  }\n}\n</script>\n","import { render } from \"./homepage.vue?vue&type=template&id=a94ee410\"\nimport script from \"./homepage.vue?vue&type=script&lang=js\"\nexport * from \"./homepage.vue?vue&type=script&lang=js\"\n\nimport exportComponent from \"/Users/risu_ann/Documents/web/dessert_work/node_modules/vue-loader-v16/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render]])\n\nexport default __exports__"],"sourceRoot":""}